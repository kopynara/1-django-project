{% extends 'base.html' %} {# base.html 템플릿을 상속받습니다. #}
{% load static %} {# 정적 파일을 사용하기 위해 로드합니다. #}

{% block title %}블로그 게시물{% endblock %} {# 페이지 제목을 설정합니다. #}

{% block content %} {# base.html의 content 블록에 이 내용을 삽입합니다. #}
    {# 태그 이름이 있다면 동적으로 제목을 변경합니다. #}
    {% if tagname %}
        <h1 class="mb-4">태그: "{{ tagname }}"이(가) 달린 게시물</h1>
    {% else %}
        <h1 class="mb-4">모든 게시물</h1>
    {% endif %}

    {% if posts %} {# posts는 PostListView 뷰에서 전달받는 게시물 객체 목록입니다. #}
        <div class="row">
            {% for post in posts %} {# 각 게시물 객체를 순회합니다. #}
                <div class="col-md-6 mb-4"> {# 한 줄에 2개의 게시물 카드를 표시합니다. #}
                    {# card h-100: 카드의 높이를 부모 요소에 맞춰 100%로 설정 #}
                    <div class="card h-100 shadow-sm rounded-3"> {# 카드 스타일 적용 #}
                        {# card-body d-flex flex-column: 카드 본문을 flexbox로 설정, 내용을 세로로 정렬 #}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a href="{% url 'blog:post_detail' slug=post.slug %}?next=index" class="text-decoration-none text-dark">
                                    {{ post.title }}
                                </a>
                                <a href="{% url 'blog:post_detail' slug=post.slug %}?next=index#disqus_thread"
                                   data-disqus-identifier="{{ post.slug }}"
                                   data-disqus-url="{{ post.get_absolute_url }}"
                                   class="text-muted small ms-2">
                                    <i class="far fa-comment"></i> 0 Comments
                                </a>
                            </h5> {# 게시물 제목 #}
                            <p class="card-text text-muted small">
                                <i class="far fa-calendar-alt"></i> {{ post.created_at|date:"Y.m.d" }}
                                {% if post.author %} | <i class="fas fa-user"></i> {{ post.author }}{% endif %}
                            </p>
                            {# flex-grow-1: 내용이 가능한 모든 공간을 차지하도록 하여 카드 높이를 균일하게 유지 #}
                            <p class="card-text flex-grow-1">{{ post.content|truncatechars:200 }}</p> {# 게시물 내용 요약 #}
                            
                            {# tags-section mt-auto pt-2: 태그 섹션을 카드 하단으로 밀어냅니다. #}
                            {% if post.tags.all %} {# 게시물에 태그가 있다면 #}
                                <div class="tags-section mt-auto pt-2"> {# 태그 섹션을 카드 하단으로 밀어냅니다. #}
                                    <i class="fas fa-tags me-1"></i>
                                    {% for tag in post.tags.all %} {# 각 태그를 순회합니다. #}
                                        <a href="{% url 'blog:post_list_by_tag' tag_slug=tag.slug %}" 
                                           class="badge bg-info text-dark me-1 mb-1 rounded-pill">
                                            {{ tag.name }}
                                        </a>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            {# 태그 표시 섹션 끝 #}

                            <div class="mt-3"> {# 버튼 상단 마진 #}
                                <a href="{% url 'blog:post_detail' slug=post.slug %}?next=index" class="btn btn-primary btn-sm">자세히 보기 &raquo;</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        {# 페이지네이션 컨트롤 시작 #}
        {% if is_paginated %} {# 페이지네이션이 적용된 경우에만 표시 #}
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {# 이전 페이지 버튼 #}
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if tagname %}&tag={{ tagname }}{% endif %}">이전</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">이전</span>
                        </li>
                    {% endif %}

                    {# 페이지 번호들 #}
                    {% for i in paginator.page_range %}
                        <li class="page-item {% if page_obj.number == i %}active{% endif %}">
                            <a class="page-link" href="?page={{ i }}{% if tagname %}&q={{ tagname }}{% endif %}">{{ i }}</a>
                        </li>
                    {% endfor %}

                    {# 다음 페이지 버튼 #}
                    {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if tagname %}&q={{ tagname }}{% endif %}">다음</a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">다음</span>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
            {# 페이지네이션 컨트롤 끝 #}

        {% else %}
            <div class="alert alert-info" role="alert">
                아직 작성된 게시물이 없습니다.
            </div>
        {% endif %}
    </div>
{% endblock content %}
