{% extends 'base.html' %} {# base.html 템플릿을 상속받습니다. #}
{% load static %} {# 정적 파일을 사용하기 위해 로드합니다. #}

{% block title %}사진 갤러리{% endblock %} {# 페이지 제목을 설정합니다. #}

{% block content %} {# base.html의 content 블록에 이 내용을 삽입합니다. #}
    <div class="container my-4">
        <h1 class="mb-4">사진 갤러리</h1>

        {% if photos %} {# photos는 PhotoLV 뷰에서 전달받는 사진 객체 목록입니다. #}
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"> {# 반응형 그리드 레이아웃 #}
                {% for photo in photos %} {# 각 사진 객체를 순회합니다. #}
                    <div class="col">
                        <div class="card h-100 shadow-sm rounded-3"> {# 카드 스타일 적용 #}
                            {# --- 디버그 라인 시작 --- #}
                            <p style="color: red; font-weight: bold;">
                                DEBUG: photo.image = {{ photo.image }}<br>
                                DEBUG: photo.image.url = {{ photo.image.url }}
                            </p>
                            {# --- 디버그 라인 끝 --- #}

                            <a href="{% url 'photo:detail' pk=photo.id %}"> {# 사진 클릭 시 상세 페이지로 이동 #}
                                {% if photo.image %}
                                    {# 이미지 비율 유지를 위해 object-fit 사용 #}
                                    <img src="{{ photo.image.url }}" class="card-img-top rounded-top-3" alt="{{ photo.title }}" style="height: 200px; object-fit: cover;">
                                {% else %}
                                    {# 이미지가 없을 경우 플레이스홀더 이미지 #}
                                    <img src="https://placehold.co/600x400/cccccc/333333?text=No+Image" class="card-img-top rounded-top-3" alt="No Image" style="height: 200px; object-fit: cover;">
                                {% endif %}
                            </a>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">
                                    <a href="{% url 'photo:detail' pk=photo.id %}" class="text-decoration-none text-dark">
                                        {{ photo.title }}
                                    </a>
                                </h5> {# 사진 제목 #}
                                <p class="card-text text-muted small mb-2">
                                    <i class="far fa-calendar-alt"></i> {{ photo.created_at|date:"Y.m.d" }}
                                    {% if photo.author %} | <i class="fas fa-user"></i> {{ photo.author }}{% endif %}
                                </p>
                                <p class="card-text flex-grow-1">{{ photo.description|truncatechars:100 }}</p> {# 사진 설명 요약 #}
                                
                                {# 태그 표시 섹션 시작 #}
                                {% if photo.tags.all %} {# 사진에 태그가 있다면 #}
                                    <div class="tags-section mt-auto pt-2"> {# 태그 섹션을 카드 하단으로 밀어냅니다. #}
                                        <i class="fas fa-tags me-1"></i>
                                        {% for tag in photo.tags.all %} {# 각 태그를 순회합니다. #}
                                            {# 태그 클릭 시 해당 태그가 달린 사진 목록으로 이동하는 링크 (아직 구현 안됨) #}
                                            <span class="badge bg-info text-dark me-1 mb-1 rounded-pill">
                                                {{ tag.name }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {# 태그 표시 섹션 끝 #}

                                <div class="mt-3"> {# 버튼 상단 마진 #}
                                    <a href="{% url 'photo:detail' pk=photo.id %}" class="btn btn-primary btn-sm">자세히 보기 &raquo;</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {# 페이지네이션 컨트롤 시작 #}
            {% if is_paginated %} {# 페이지네이션이 적용된 경우에만 표시 #}
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {# 이전 페이지 버튼 #}
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">이전</a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">이전</span>
                            </li>
                        {% endif %}

                        {# 페이지 번호들 #}
                        {% for i in paginator.page_range %}
                            <li class="page-item {% if page_obj.number == i %}active{% endif %}">
                                <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                            </li>
                        {% endfor %}

                        {# 다음 페이지 버튼 #}
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}">다음</a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">다음</span>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
            {# 페이지네이션 컨트롤 끝 #}

        {% else %}
            <div class="alert alert-info" role="alert">
                아직 등록된 사진이 없습니다.
            </div>
        {% endif %}
    </div>
{% endblock content %}
